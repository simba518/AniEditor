\documentclass[twocolumn,a4paper]{article}
\usepackage{graphicx}
\usepackage{amsfonts}
\usepackage{color}
\usepackage{lineno}
\setlength{\columnsep}{10pt}
\setlength{\oddsidemargin}{0pt}
\setlength{\topmargin}{0pt}
\setlength{\headheight}{0pt}
\setlength{\headsep}{0pt}
\setlength{\marginparsep}{0pt}
\setlength{\marginparwidth}{0pt}
\addtolength{\voffset}{-50pt}
\setlength{\textheight}{26.8cm}
\author{Siwang Li}

\title{Implementation of Material Optimization}

%% document begin here
\begin{document}
\maketitle

\section{Input Animation}
The input are some displacements $P = (p_1,\cdots,p_T) \in R^{3n\times T}$ of a
beam with respect to the rest shape $r$. We use implicit integrator, zero
damping ($\alpha_k=\alpha_m=0$), and same time step $h=0.1$ in all the
experiments if is not indicated. Some of the animation are produced with some
nodes are fixed, but no other external forces. We produce such results by
setting a deformed shape as initial state, then record the simulated result. And
for the reduced simulator, constraints are achieved by removing the
corresponding rows from the basis matrix.

\section{PCA on RS coordinates}
Firstly, we compute the RS coordinates $\hat{P} =
(\hat{p}_1,\cdots,\hat{p}_T)$.  Then we solve the SVD problem $\hat{P} = U\Sigma
V^T$, and use the first $m$ columns of $U$ to obtain $W' = (u_1,\cdots,u_m)$,
and the corresponding reduced coordinates $z' = ((\Sigma V^T)_1,\cdots,(\Sigma
V^T)_T)$.

\subsection{Experiments}
\begin{itemize}
\item Check the residual $\hat{P}-W'z'$ to make sure the PCA is correct. It
  should be very small.({\color{red}the results $<10^{-4}$})
\item Use the 6-th mode $w_6$ to produce a set of reduced coordinates
  $z_i=i\times w_6$, and corresponding RS coordinates $\hat{p}_i=\hat{W}z_i$,
  where $\hat{W}$ is the RS modal matrix, which is computed from the given
  elastic material. Then use $\hat{P}$ to compute $W'$ and $z'$. Then check the
  residual $\|(|w_6|z)-z'\|_2^2$ and
  $\|\frac{\hat{W}}{|w_6|}-W'\|_2^2$({\color{red}We normalize $\hat{W}$ is
    because $W'$ is normalized and $\hat{W}$ is not. After nomalization, the
    residuals are smaller than $10^{-16}$}).
\item Use both the 6-th and 7-th modes to make the similar experiment as
  above.({\color{red}Residual is large ($>0.2$), as columns in $W'$ are
    orthogonal, while it is not true in $\hat{W}$ .})
%% \item Use the first 20 modes to simulate an animation using a RS simulator with
%%   some nodes are constrained, and record $z$ and $\hat{P}$. Then check the
%%   residual $\|z-z'\|_2^2$ and $\|\hat{W}-W'\|_2^2$.({\color{red} have not made.})
%% \item Generate an animation using a Reduced StVK simulator with some nodes are
%%   constrained. Then use it to compute $W'$ and $z'$. Then check the residual
%%   $\|z-z'\|_2^2$ and $\|\hat{W}-W'\|_2^2$.({\color{red} have not made.})
\end{itemize}

\subsection{Conclusion}
With PCA, the $W'z'$ can well approximate the input RS coordinates. However, the
residual $\|\hat{W}-W'\|_2^2$ and $\|z-z'\|$ can be very large. This is because
the PCA result $W'$ are orthogonal, while the true RS modal matrix $\hat{W}$ is
usually not.

\section{Approximate $K$ Without Constraints}
To compute $K$, we discrete $z(t)$ in time, and define a quadratic energy
function
\begin{equation} \label{qua-en}
  E(k) = \sum_{i=2}^{T-1} \|\frac{1}{h^2}\hat{z}_i+\frac{1}{h}\hat{D}(z_{i+1}-z_{i})+ K(k)z_i\|_2^2
\end{equation}
where $\hat{z}_i=z_{i+1}-2z_{i}+z_{i-1}$,$\hat{D}=\alpha_kK(k)+\alpha_m$, and
$K(k)$ is a symmetric matrix which is obtained by properly assemble $k_i$ into
$K$. This quadratic energy function can be minimized by solving
\begin{equation} \label{sol}
  Hk = -b
\end{equation}
where $H = \frac{\partial^2{E}}{\partial^2{k}}$ is a constant matrix, and $b =
\frac{\partial{E}}{\partial{k}}|_{k=0}$ is a constant vector. 

\subsection{Experiments}
\begin{itemize}
\item Use an random vector $x$ to check $E(x)-(\frac{1}{2}x^THx+b^Tx+E(0))$ to
  make sure $H$ and $b$ are correct.({\color{red}result $<10^{-10}E(x)$}).
\item Check $Hk = -b$ to make sure the equation solving is
  correct({\color{red}result $<10^{-8}$}).
\item We use a single mode (eigenvalue $\lambda=0.5$) to produce the animation
  $z'_1,\cdots,z'_{100}$ with a RS simulator without constraints. Implicit
  integration method is used. Then we use it to produce $K\in R^{1\times1}$. We
  check the residual $|\frac{K}{\lambda}-1|$,$E(\lambda)$, and
  $E(k)$. ({\color{red}the values are 0.01,4.618,4.515. $E(\lambda)$ is not
    zero, because the descrete scheme in equation (\ref{qua-en}) is actually not
    equal to an implicit integration.}).
\item Use different time step $h$ to make the above
  experiment. ({\color{red}when $h$ become larger, the residual $E(k)$ become
    smaller. Suppose $\zeta$ is the scalor for $h$, then $E(k,\zeta h) =
    \frac{E(k,h)}{\zeta^4}$}.)
\item We use the first 20 modes to produce the animation $z'_0,\cdots,z'_{T}$
  with a RS simulator without constraints, then use it to compute $K$. We check
  the residual $E(k)$. ({\color{red}We choose different $T=10,20,50,100$, and
    the corresponding residuals are $E(k)=1.63,23.08,281.5,400$})
\item Make a similar experiment as above, but with some nodes are
  constrained. There is no need to introduce additional constraint forces into
  to (\ref{qua-en}), as we constrained the nodes during the modal analysis
  process by removing the corresponding columns and rows from the stiffness and
  mass matrix. ({\color{red}We choose different $T=10,20,50,100$, and
    the corresponding residuals are $E(k)=0.8,10.47,187.4,285.9$})
\item Produce $z'$ of only one mode ($\lambda = 0.5$) without damping using
  analysis simulator $z(\lambda,t)$. Print the two curves $z(\lambda,t)$ and
  $z(k,t)$, check $E(\lambda)$ and $E(k)$.
\item Make the same experiment as above, but introduce damping to produce $z(t)$
  and use the same damping in $E(k)$ to compute $k$.
\item Make the same experiment as above, but the damping in $E(k)$ is set as
  unknowns.
%% \item Use different time step $h$ to make the above experiment.
%% \item We use a full StVK simulator to produce an animation $P =
%%   (p_1,\cdots,p_T)$ without constraints. Then compute $K$ and check the residual
%%   $E(k)$.
%% \item Use different time step $h$ to make the above experiment.
%% \item Use the same $P$ as above, but compute $z' = \hat{W}^{-1}\hat{P}$. Check
%%   the residual $E(\Lambda)$.
%% \item Use same $z'$ as above, compute $K$, check the residual $E(k)$.
%% \item Produce all the input and out animation, check the deformation results and
%%   dynamics.
\end{itemize}

\subsection{Conclusion}
Firstly, because the discrete scheme in equation (\ref{qua-en}) is not equal to
an implicit integration. Thus if the animation is produced by using an implicit
simulator, the real elastic material can not satisfy $E(k)=0$. Secondly, large
time step will result in small residual $E(k)$. Thirdly, larger $T$ will result
in larger residual $E(k)$. This is because we use the quadratic objective
(\ref{qua-en}) to minimize the residual of $r\times T$ linear equations, with
unknowns of $r\times r$.

\section{Analysis Results}
If we consider one mode, then the analysis function $z(t)\in R^1$ for the
following motion equation
\begin{equation} \label{deeq}
  \ddot{z} + (\alpha_m+\alpha_k\lambda^2)\dot{z} + \lambda^2z = 0
\end{equation}
would be
\begin{equation} \label{oss}
  z(t) = (Pcos(wt) + Qsin(wt))e^{-\alpha t}
\end{equation}
where the angular velocity is defined as $w = \sqrt{\lambda^2-\alpha^2}$, the
decay rate $\alpha = (\alpha_k\lambda^2+\alpha_m)/2$, and $P$ and $Q$ are
arbitrary scalar values depicting the initial amplitude and phase of this mode,
\begin{eqnarray}\label{PQ}
  P &=& z(0) \\
  Q &=& \frac{1}{w}(\dot{z}(0) + \alpha P)
\end{eqnarray}

%% references
% \begin{thebibliography}{99}
% \bibitem{sig2011} Fast simulation of skeleton-driven deformable body
%   characters.
% \end{thebibliography}

\end{document}
